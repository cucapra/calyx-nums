(FPCore (channel metallic metallicChannel cosAngle)
 :name "ComputeMetallic"
 :description "Metallic attenuation"
 :cite (povray)
 :pre (and (<= 0.0 channel 1.0)
           (<= 0.0 metallic 1.0)
           (<= 0.0 metallicChannel 1.0)
           (<= -1.0 cosAngle 1.0))
 (let* ([x (/ (fabs (acos cosAngle)) PI_2)]
        [F (- (/ 0.014567225 (* (- x 1.12) (- x 1.12))) 0.011612903)]
        [F (fmin 1.0 (fmax 0.0 F))])
   (* channel (+ 1.0 (* (* metallic (- 1.0 F)) (- metallicChannel 1.0))))))
